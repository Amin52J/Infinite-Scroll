var InfiniteScroll=function(t){var e=function(){var t=arguments,e={async:t[0].async||!0,beforeSend:t[0].beforeSend||function(){},complete:t[0].complete||function(){},contentType:t[0].contentType||"application/x-www-form-urlencoded; charset=UTF-8",data:t[0].data||"",dataType:t[0].dataType||"text",error:t[0].error||function(){},fail:t[0].fail||function(){},headers:t[0].headers||{},method:t[0].method||"POST",stringify:t[0].stringify||!1,success:t[0].success||function(){},timeout:t[0].timeout||0,url:t[0].url||"/"},i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){var t=i.responseText;if("json"===e.dataType)try{t=JSON.parse(i.responseText)}catch(e){t=t}e.complete(t),200==i.status?e.success(t,i):400==i.status?e.error(i,i.status,i.responseText):e.fail(i,i.status,i.responseText)}};var n,s="";if(e.stringify&&"POST"===e.method){for(n in e.data)s+=String(n)+"="+JSON.stringify(e.data[n])+"&";e.data=s}else{for(n in e.data)s+=String(n)+"="+e.data[n]+"&";e.data=s}"POST"===e.method?i.open(e.method,e.url,e.async):i.open(e.method,e.url+(e.url.indexOf("?")>-1?"&":"?")+e.data,e.async),i.responseType="",i.timeout=e.timeout,i.setRequestHeader("Content-Type",e.contentType);for(n in e.headers)i.setRequestHeader(n,e.headers[n]);e.beforeSend(),"POST"===e.method?i.send(e.data):i.send()},i=function(){this.infiniteScrolling=!0;var t="function"==typeof this.request.data?this.request.data():this.request.data;"string"==typeof this.loadingElement?this.container.insertAdjacentHTML("beforeend",this.loadingElement):this.container.appendChild(this.loadingElement),e({url:this.url,data:t,method:this.request.method,headers:{"x-requested-with":"XMLHttpRequest"},complete:function(){this.infiniteScrolling=!1,this.container.querySelector(".infinite-scroll__loading").parentNode.removeChild(this.container.querySelector(".infinite-scroll__loading"))}.bind(this),success:function(t,e){this.onLoad.call(this.container,t,e)}.bind(this)})},n=function(t){t||(t={}),this.container=t.container||document.body,this.scrollTarget=t.scrollTarget||this.container,this.url=t.url||this.container.getAttribute("data-url"),this.request={data:"",method:"GET"},this.request.data=t.request&&t.request.data?t.request.data:this.request.data,this.request.method=t.request&&t.request.method?t.request.method:this.container.getAttribute("data-method")||this.request.method,this.loading=!1,this.loadingElement=t.loading||'<div class="infinite-scroll__loading">Loading...</div>',this.moreButton=t.moreButton,this.infiniteScrolling=!1,this.allItemsLoaded=!1,this.margin=t.margin||this.container.getAttribute("data-margin")?parseInt(this.container.getAttribute("data-margin")):500;var e=this;this.onLoad=t.onLoad||function(t,i){"string"==typeof t&&t.length>0||!i.getResponseHeader("x-last-page")?this.insertAdjacentHTML("beforeend",t):e.allDataLoaded(!0)},this.moreButtonClickFunction=function(){this.infiniteScrolling||this.allItemsLoaded||i.call(this)}.bind(this),this.scrollEventTarget="body"===this.scrollTarget.tagName.toLowerCase()?window:this.scrollTarget,this.scrollFunction=function(){this.scrollTarget.scrollTop>this.container.scrollHeight-("body"===this.scrollTarget.tagName.toLowerCase()?window:this.scrollTarget).innerHeight-this.margin&&!this.infiniteScrolling&&!this.allItemsLoaded&&i.call(this)}.bind(this),this.moreButton?this.moreButton.addEventListener("click",this.moreButtonClickFunction):this.scrollEventTarget.addEventListener("scroll",this.scrollFunction)};return n.prototype.allDataLoaded=function(t){return this.allItemsLoaded=!!t,this.moreButton&&(this.moreButton.style.display="none"),this},n.prototype.unbind=function(){this.moreButton?this.moreButton.removeEventListener("click",this.moreButtonClickFunction):this.scrollEventTarget.removeEventListener("scroll",this.scrollFunction)},new n(t)};
