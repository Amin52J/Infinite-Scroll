var InfiniteScroll=function(t){var e=function(){var t=arguments,e={async:t[0].async||!0,beforeSend:t[0].beforeSend||function(){},complete:t[0].complete||function(){},contentType:t[0].contentType||"application/x-www-form-urlencoded; charset=UTF-8",data:t[0].data||"",dataType:t[0].dataType||"text",error:t[0].error||function(){},fail:t[0].fail||function(){},headers:t[0].headers||{},method:t[0].method||"POST",stringify:t[0].stringify||!1,success:t[0].success||function(){},timeout:t[0].timeout||0,url:t[0].url||"/"},n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var t=n.responseText;if("json"===e.dataType)try{t=JSON.parse(n.responseText)}catch(e){t=t}e.complete(t),200==n.status?e.success(t,n):400==n.status?e.error(n,n.status,n.responseText):e.fail(n,n.status,n.responseText)}};var i,o="";if(e.stringify&&"POST"===e.method){for(i in e.data)o+=String(i)+"="+JSON.stringify(e.data[i])+"&";e.data=o}else{for(i in e.data)o+=String(i)+"="+e.data[i]+"&";e.data=o}"POST"===e.method?n.open(e.method,e.url,e.async):n.open(e.method,e.url+(e.url.indexOf("?")>-1?"&":"?")+e.data,e.async),n.responseType="",n.timeout=e.timeout,n.setRequestHeader("Content-Type",e.contentType);for(i in e.headers)n.setRequestHeader(i,e.headers[i]);e.beforeSend(),"POST"===e.method?n.send(e.data):n.send()},n=function(){this.infiniteScrolling=!0;var t="function"==typeof this.request.data?this.request.data():this.request.data;"string"==typeof this.loadingElement?this.container.insertAdjacentHTML("beforeend",this.loadingElement):this.container.appendChild(this.loadingElement),e({url:this.url,data:t,method:this.request.method,headers:{"x-requested-with":"XMLHttpRequest"},complete:function(){this.infiniteScrolling=!1,this.container.querySelector(".infinite-scroll__loading").parentNode.removeChild(this.container.querySelector(".infinite-scroll__loading"))}.bind(this),success:function(t,e){this.onLoad.call(this.container,t,e)}.bind(this)})},i=function(t){return"body"===t.tagName.toLowerCase()?window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0:t.scrollTop},o=function(t){t||(t={}),this.container=t.container||document.body,this.scrollTarget=t.scrollTarget||this.container,this.url=t.url||this.container.getAttribute("data-url"),this.request={data:"",method:"GET"},this.request.data=t.request&&t.request.data?t.request.data:this.request.data,this.request.method=t.request&&t.request.method?t.request.method:this.container.getAttribute("data-method")||this.request.method,this.loading=!1,this.loadingElement=t.loading||'<div class="infinite-scroll__loading">Loading...</div>',this.moreButton=t.moreButton,this.infiniteScrolling=!1,this.allItemsLoaded=!1,this.margin=t.margin||this.container.getAttribute("data-margin")?parseInt(this.container.getAttribute("data-margin")):500;var e=this;this.onLoad=t.onLoad||function(t,n){"string"==typeof t&&t.length>0?(this.insertAdjacentHTML("beforeend",t),n.getResponseHeader("x-last-page")&&"false"!==n.getResponseHeader("x-last-page")&&e.allDataLoaded(!0)):e.allDataLoaded(!0)},this.moreButtonClickFunction=function(){this.infiniteScrolling||this.allItemsLoaded||n.call(this)}.bind(this),this.scrollEventTarget="body"===this.scrollTarget.tagName.toLowerCase()?window:this.scrollTarget,this.scrollFunction=function(){i(this.scrollTarget)>this.container.scrollHeight-("body"===this.scrollTarget.tagName.toLowerCase()?window:this.scrollTarget).innerHeight-this.margin&&!this.infiniteScrolling&&!this.allItemsLoaded&&n.call(this)}.bind(this),this.moreButton?this.moreButton.addEventListener("click",this.moreButtonClickFunction):this.scrollEventTarget.addEventListener("scroll",this.scrollFunction)};return o.prototype.allDataLoaded=function(t){return this.allItemsLoaded=!!t,this.moreButton&&(this.moreButton.style.display="none"),this},o.prototype.unbind=function(){this.moreButton?this.moreButton.removeEventListener("click",this.moreButtonClickFunction):this.scrollEventTarget.removeEventListener("scroll",this.scrollFunction)},new o(t)};
