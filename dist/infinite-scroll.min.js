var InfiniteScroll=function(t){var e=function(){var t=arguments,e={async:t[0].async||!0,beforeSend:t[0].beforeSend||function(){},complete:t[0].complete||function(){},contentType:t[0].contentType||"application/x-www-form-urlencoded; charset=UTF-8",data:t[0].data||"",dataType:t[0].dataType||"text",error:t[0].error||function(){},fail:t[0].fail||function(){},headers:t[0].headers||{},method:t[0].method||"POST",stringify:t[0].stringify||!1,success:t[0].success||function(){},timeout:t[0].timeout||0,url:t[0].url||"/"},i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){var t=i.responseText;if("json"===e.dataType)try{t=JSON.parse(i.responseText)}catch(e){t=t}e.complete(t),200==i.status?e.success(t):400==i.status?e.error(i,i.status,i.responseText):e.fail(i,i.status,i.responseText)}};var n,o="";if(e.stringify&&"POST"===e.method){for(n in e.data)o+=String(n)+"="+JSON.stringify(e.data[n])+"&";e.data=o}else{for(n in e.data)o+=String(n)+"="+e.data[n]+"&";e.data=o}if("POST"===e.method?i.open(e.method,e.url,e.async):i.open(e.method,e.url+"?"+e.data,e.async),i.responseType="",i.timeout=e.timeout,i.setRequestHeader("Content-Type",e.contentType),void 0!==e.headers.length)for(n in e.headers)i.setRequestHeader(n,e.headers[n]);e.beforeSend(),"POST"===e.method?i.send(e.data):i.send()},i=function(){this.infiniteScrolling=!0,this.container.insertAdjacentHTML("beforeend",this.loadingElement),e({url:this.url,data:this.request.data,method:this.request.method,complete:function(){this.infiniteScrolling=!1,this.container.querySelector(".infinite-scroll__loading").parentNode.removeChild(this.container.querySelector(".infinite-scroll__loading"))}.bind(this),success:function(t){this.onLoad.call(this.container,t)}.bind(this)})};return new function(t){t||(t={}),this.container=t.container||document.body,this.url=t.url||this.container.getAttribute("data-url"),this.request={data:"",method:"GET"},this.request.data=t.request&&t.request.data?t.request.data:this.request.data,this.request.method=t.request&&t.request.method?t.request.method:this.request.method,this.loading=!1,this.loadingElement=t.loading||'<div class="infinite-scroll__loading">Loading...</div>',this.mode=t.mode||this.container.getAttribute("data-mode"),this.moreButton=t.moreButton,this.infiniteScrolling=!1,this.allItemsLoaded=!1,this.margin=t.margin||300,this.onLoad=t.onLoad||function(t){console.log(t)},"button"===this.mode?this.moreButton?this.moreButton.addEventListener("click",function(){this.infiniteScrolling||this.allItemsLoaded||i.call(this)}.bind(this)):console.error("Please specify a moreButton inside the config or remove the button mode."):("body"===this.container.tagName.toLowerCase()?window:this.container).addEventListener("scroll",function(){this.container.scrollTop>this.container.scrollHeight-("body"===this.container.tagName.toLowerCase()?window:this.container).innerHeight-this.margin&&!this.infiniteScrolling&&!this.allItemsLoaded&&i.call(this)}.bind(this))}(t)};
