var InfiniteScroll=function(t){var e=function(){var t=arguments,e={async:t[0].async||!0,beforeSend:t[0].beforeSend||function(){},complete:t[0].complete||function(){},contentType:t[0].contentType||"application/x-www-form-urlencoded; charset=UTF-8",data:t[0].data||"",dataType:t[0].dataType||"text",error:t[0].error||function(){},fail:t[0].fail||function(){},headers:t[0].headers||{},method:t[0].method||"POST",stringify:t[0].stringify||!1,success:t[0].success||function(){},timeout:t[0].timeout||0,url:t[0].url||"/"},n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var t=n.responseText;if("json"===e.dataType)try{t=JSON.parse(n.responseText)}catch(e){t=t}e.complete(t),200==n.status?e.success(t):400==n.status?e.error(n,n.status,n.responseText):e.fail(n,n.status,n.responseText)}};var i,o="";if(e.stringify&&"POST"===e.method){for(i in e.data)o+=String(i)+"="+JSON.stringify(e.data[i])+"&";e.data=o}else{for(i in e.data)o+=String(i)+"="+e.data[i]+"&";e.data=o}if("POST"===e.method?n.open(e.method,e.url,e.async):n.open(e.method,e.url+"?"+e.data,e.async),n.responseType="",n.timeout=e.timeout,n.setRequestHeader("Content-Type",e.contentType),void 0!==e.headers.length)for(i in e.headers)n.setRequestHeader(i,e.headers[i]);e.beforeSend(),"POST"===e.method?n.send(e.data):n.send()},n=function(){this.infiniteScrolling=!0,this.container.insertAdjacentHTML("beforeend",this.loadingElement),e({url:this.url,data:this.request.data,method:this.request.method,complete:function(){this.infiniteScrolling=!1,this.container.querySelector(".infinite-scroll__loading").parentNode.removeChild(this.container.querySelector(".infinite-scroll__loading"))}.bind(this),success:function(t){this.onLoad.call(this.container,t)}.bind(this)})},i=function(t){t||(t={}),this.container=t.container||document.body,this.url=t.url||this.container.getAttribute("data-url"),this.request={data:"",method:"GET"},this.request.data=t.request&&t.request.data?t.request.data:this.request.data,this.request.method=t.request&&t.request.method?t.request.method:this.request.method,this.loading=!1,this.loadingElement=t.loading||'<div class="infinite-scroll__loading">Loading...</div>',this.mode=t.mode||this.container.getAttribute("data-mode"),this.moreButton=t.moreButton,this.infiniteScrolling=!1,this.allItemsLoaded=!1,this.margin=t.margin||300,this.onLoad=t.onLoad||function(t){console.log(t)},this.moreButtonClickFunction=function(){this.infiniteScrolling||this.allItemsLoaded||n.call(this)}.bind(this),this.scrollEventTarget="body"===this.container.tagName.toLowerCase()?window:this.container,this.scrollFunction=function(){this.container.scrollTop>this.container.scrollHeight-("body"===this.container.tagName.toLowerCase()?window:this.container).innerHeight-this.margin&&!this.infiniteScrolling&&!this.allItemsLoaded&&n.call(this)}.bind(this),"button"===this.mode?this.moreButton?this.moreButton.addEventListener("click",this.moreButtonClickFunction):console.error("Please specify a moreButton inside the config or remove the button mode."):this.scrollEventTarget.addEventListener("scroll",this.scrollFunction)};return i.prototype.allDataLoaded=function(t){return this.allItemsLoaded=!!t,this},i.prototype.unbind=function(){"button"===this.mode&&this.moreButton?this.moreButton.removeEventListener("click",this.moreButtonClickFunction):this.scrollEventTarget.removeEventListener("scroll",this.scrollFunction)},new i(t)};
